### 操作数据 vs 配置数据
我们已经得到的`bookzone`模型可以说是比较完美地实现了对图书购买的功能，但随着时代的发展，数据分析渐渐成为了这类管理系统的重要需求之一。例如说，图书的标题与销售的数量之间必然存在某种相关性，这就需要统计出不同的标题对应的受欢迎程度。这个数据通常是由系统根据某些触发事件自动修改的（例如在发生购买行为时修改图书的销量），这显然不能是人为设置的。因此在YANG模型中使用`config false`来标记这类数据，与之相对，`config true`用来标记可配置的数据。二者通常被称为**操作数据**和**配置数据**。

可以考虑记录过去十二个月的销售量作为**受欢迎程度**，如下：
```yang
container books { 
  list book { 
... 
    leaf popularity { 
      config false; 
      type uint32; 
      units copies-sold/year; 
      description 
        "Number of copies sold in the last 12-month period"; 
    }
...
}
```
显然，实现这一YANG模型的系统需要通过代码来实现对`popularity`数据的查询功能，或者通过更新数据库的方式向外提供查询接口。

管理系统中通常还需要查询图书的**库存数量**，例如总库存、被预订数量、可发货数量等，可如下实现：
```yang
container books { 
  list book { 
... 
    list format { 
... 
      container number-of-copies { 
        config false; 
        leaf in-stock { 
          type uint32; 
        } 
        leaf reserved { 
          type uint32; 
        } 
        leaf available { 
          type uint32; 
        } 
      }
...
}
```
值得注意的是，一旦一个元素被配置为`config false`属性，那么它内部的所有元素（例如上例中的`in-stock`、`reserved`、`available`）也都会继承这个特性并且不能被设置为`config true`，我们创建一个这样的测试模型并用Pyang验证一下：
```yang
module config-test{
  yang-version 1.1; 
  namespace 'http://example.com/ns/config-test'; 
  prefix ct; 
  container test_container { 
    config false;
    list test { 
      key test_key; 
      leaf test_key { 
        config true;
        type string; 
      }  
    } 
  } 
}
```
使用Pyang验证会报错：
```
> pyang  .\config-test.yang
.\config-test.yang:11: error: config true cannot be set when the parent is config false
```
接下来需要实现的是**购买历史**，我们可以在`user`列表下添加购买过的图书，也可以在`book`下添加购买过这本书的读者。这里我们选择在`/users/user`下添加购买过的图书，如下：
```yang
container users { 
  list user { 
... 
    list purchase-history { 
      config false; 
      key "title format"; 
      uses title-format-ref; 
      leaf transaction-date-time { 
        type yang:date-and-time; 
      } 
      leaf copies { 
        type uint32; 
      } 
    } 
  } 
}
```
这个例子中的`purchase-history`有两个主键，分别是`title`和`format`，在这种多主键的情况下用引号把主键括起来，在主键之间用空格分隔。

在进行YANG建模时，经常会遇到一些叶子组合或者说多个列表组合的结构需要重复调用。在这种情况下可以把它们定义为`grouping`，在之后可以直接调用。上例中的`uses`关键字就是用来实例化这种`grouping`的。

以下为`grouping`的定义：
```yang
grouping title-format-ref { 
  leaf title { 
    type leafref { 
      path /books/book/title; 
    } 
  } 
  leaf format { 
    type leafref { 
      path /books/book/format/format-id; 
    } 
  } 
}
```
可以回想起来我们在`notification shipping`中也使用了`title`和`format`两个叶子节点，因此可以将它的定义改为下面这样：
```yang
notification shipping { 
  leaf user { 
    type leafref { 
      path /users/user/name; 
    } 
  } 
  uses title-format-ref;
  leaf number-of-copies { 
    type uint32; 
  } 
}
```
在`purchase`动作中可以做同样的改进：
```yang
action purchase { 
  input { 
    uses title-format-ref;
    leaf number-of-copies { 
      type uint32 { 
        range 1..999; 
      } 
    } 
  } 
...
}
```
通过对`title-format-ref`的复用，我们可以显著减少代码的行数，现在我们可以使用Pyang查看我们的YANG模型的最新结构了：
```sh
> pyang -f tree .\bookzone-example.yang
module: bookzone-example
  +--rw authors
  |  +--rw author* [name]
  |     +--rw name          string
  |     +--rw account-id?   uint32
  +--rw books
  |  +--rw book* [title]
  |     +--rw title         string
  |     +--rw author?       -> /authors/author/name
  |     +--rw language?     language-type
  |     +--rw format* [isbn]
  |     |  +--rw isbn                ISBN-10-or-13
  |     |  +--rw format-id           identityref
  |     |  +--rw price?              decimal64
  |     |  +--ro number-of-copies
  |     |     +--ro in-stock?    uint32
  |     |     +--ro reserved?    uint32
  |     |     +--ro available?   uint32
  |     +--ro popularity?   uint32
  +--rw users
     +--rw user* [user-id]
        +--rw user-id             string
        +--rw name?               string
        +--ro purchase-history* [title format]
        |  +--ro title                    -> /books/book/title
        |  +--ro format                   -> /books/book/format/format-id
        |  +--ro transaction-date-time?   yang:date-and-time
        |  +--ro copies?                  uint32
        +---x purchase
           +---w input
           |  +---w title?              -> /books/book/title
           |  +---w format?             -> /books/book/format/format-id
           |  +---w number-of-copies?   uint32
           +--ro output
              +--ro (outcome)?
                 +--:(success)
                 |  +--ro success?        empty
                 |  +--ro delivery-url?   string
                 +--:(out-of-stock)
                 |  +--ro out-of-stock?   empty
                 +--:(failure)
                    +--ro failure?        string

  notifications:
    +---n shipping
       +--ro user?               -> /users/user/name
       +--ro title?              -> /books/book/title
       +--ro format?             -> /books/book/format/format-id
       +--ro number-of-copies?   uint32
```
可以看到在树状结构中`title-format-ref`已经被展开了。

同时在yang文件前面添加`revision`来记录每次修订的时间和内容：
```yang
revision 2025-12-15 { 
  description 
    "Added status information about books and purchases, see 
     /books/book/popularity 
     /books/book/formats/number-of-copies 
     /users/user/purchase-history 
     Turned reference to book title & format into a grouping, 
     updated references in 
     /users/user/purchase 
     /shipping"; 
}
```

需要注意的是，对于`config false`的数据，YANG允许不为它们设置主键，这样的列表只能选择读取全部数据，非常不方便。除非该列表内容为只读且数量可控，否则建议至少设置一个主键以便查询。