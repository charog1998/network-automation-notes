书接上回，我们已经构造了一个关于图书管理的模块。但依然存在一些问题。

### 列表中的列表
在现实中，某一本书可能存在多种发行版本，比如有声书、电子书、纸质书（可能还分简装或精装版），不同版本的**ISBN**编码是不一样的。对于这种情况，可以选择创建多个书本实体，例如：《活着（精装版）》和《活着（简装版）》。
但是也有一种更精简的办法，就是在一本书的下方存储它对应的多个版本以及对应的ISBN，类似下面这样：
```
container books { 
    list book { 
      key title; 
      leaf title { 
        type string; 
      } 
...
...
      list format { 
        key isbn; 
        leaf isbn { 
          type ISBN-10-or-13; 
        } 
        leaf format-id { 
            ???
        } 
      }
```
这样的结构相当于在book这张表的每一个实体内又添加了一个列表`format`，其中每一个`format`都具有自己的`isbn`以及`format-id`。用Python来表示可能就是下面这样的结构：
```python
[
    {
        title: '活着',
        author: '余华',
        format:
        [
            {
                isbn: 'abcdef1234',
                format-id: 精装
            },
            {
                isbn: 'qwerty5678',
                format-id: 有声书
            }
        ]
    }
]
```

### 身份（identity）与身份引用（identityref）
接下来我们考虑`format-id`应该如何设计，首先想到的是：显然可以使用前面了解过的**枚举enumeration**，但是因为有可能某些书籍的版本之间是存在内在联系的，例如说，显然精装书与简装书都是纸质书，在实际处理中可能存在一些共性，起码是与MP3版本存在明显差别的。
YANG提供了一种方法，可以定义一系列的**身份identity**，并且令它们之间具有一定的继承关系：
```yang
identity format-idty { 
  description "Root identity for all book formats"; 
} 
identity paper { 
  base format-idty; 
  description "Physical book printed on paper"; 
} 
identity audio-cd { 
  base format-idty; 
  description "Audiobook delivered as Compact 
Disc"; 
} 
identity file-idty { 
  base format-idty; 
  description "Book delivered as a file"; 
} 
identity paperback { 
  base paper; 
  description "Physical book with soft covers"; 
} 
identity hardcover { 
  base paper; 
  description "Physical book with hard covers"; 
} 
identity mp3 { 
  base file-idty; 
  description "Audiobook delivered as MP3 file"; 
} 
identity pdf { 
  base file-idty; 
  description "Digital book delivered as PDF file"; 
} 
identity epub { 
  base file-idty; 
  description "Digital book delivered as EPUB file"; 
}
```
这样我们就定义了一系列存在继承关系的**format**，以清晰的形式可以表示为：
```
format-idty
    paper
        paperback
        hardcover
    audio-cd
    file-idty
        mp3
        pdf
        epub
```
其中`format-idty`是所有**format**的“基类”，此时我们可以简单地使用`identityref`关键字来引用所有以`format-idty`为基类的其他“子类”。前文的`leaf format-id`的内容可以定义为：
```yang
leaf format-id { 
  mandatory true; 
  type identityref { 
    base format-idty; 
  } 
}
```

### 完整版
综合前面的所有内容，可以得到一个完整版的`bookzone-example`模型：
```yang
module bookzone-example { 
  yang-version 1.1; 
  namespace 'http://example.com/ns/bookzone'; 
  prefix bz; 

  import ietf-yang-types { 
    prefix yang; 
  } 
  revision 2025-12-11 { 
    description 
      "Added book formats, authors and users, see 
       /books/book/format 
       /authors 
       /users"; 
  } 
  revision 2025-12-09 { 
    description "Initial revision. A catalog of books."; 
  } 
  typedef language-type { 
    type enumeration { 
      enum arabic; 
      enum chinese; 
      enum english; 
      enum french; 
      enum moroccan-arabic; 
      enum swahili; 
      enum swedish; 
      ...
    } 
    description 
      "Primary language the book consumer needs to master "+ 
      "in order to appreciate the book's content"; 
  } 
  identity format-idty { 
    description "Root identity for all book formats"; 
  } 
  identity paper { 
    base format-idty; 
    description "Physical book printed on paper"; 
  } 
  identity audio-cd { 
    base format-idty; 
    description "Audiobook delivered as Compact Disc"; 
  } 
  identity file-idty { 
    base format-idty; 
    description "Book delivered as a file"; 
  } 
  identity paperback { 
    base paper; 
    description "Physical book with soft covers"; 
  } 
  identity hardcover { 
    base paper; 
    description "Physical book with hard covers"; 
  } 
  identity mp3 { 
    base file-idty; 
    description "Audiobook delivered as MP3 file"; 
  } 
  identity pdf { 
    base file-idty; 
    description "Digital book delivered as PDF file"; 
  } 
  identity epub { 
    base file-idty; 
    description "Digital book delivered as EPUB file"; 
  } 
  typedef ISBN-10-or-13 { 
    type union { 
      type string { 
        length 10; 
        pattern '[0-9]{9}[0-9X]'; 
      } 
      type string { 
        length 13; 
        pattern '97[89][0-9]{10}'; 
      } 
    } 
    description 
      "The International Standard Book Number (ISBN) is a unique 
       numeric commercial book identifier. 
       An ISBN is assigned to each edition and variation (except 
       reprintings) of a book. [source: wikipedia]"; 
    reference 
"https://en.wikipedia.org/wiki/International_Standard_Book_Number";
  } 
  container authors { 
    list author { 
      key name; 
      leaf name { 
        type string; 
      } 
      leaf account-id { 
        type uint32 { 
          range 1001..max; 
        } 
      } 
    } 
  } 
  container books { 
    list book { 
      key title; 
      leaf title { 
        type string; 
      } 
      leaf author { 
        type leafref { 
          path /authors/author/name; 
        } 
      } 
      leaf language { 
        type language-type; 
      } 
      list format { 
        key isbn; 
        leaf isbn { 
          type ISBN-10-or-13; 
        } 
        leaf format-id { 
          mandatory true; 
          type identityref { 
            base format-idty; 
          } 
        } 
        leaf price { 
          type decimal64 { 
            fraction-digits 2; 
          } 
          units sim-dollar; 
        } 
      } 
    } 
  } 
  container users { 
    list user { 
      key user-id; 
      leaf user-id { 
        type string; 
      } 
      leaf name { 
        type string; 
      } 
    } 
  } 
}
```